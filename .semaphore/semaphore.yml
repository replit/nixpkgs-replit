version: v1.0
name: test
agent:
  machine:
    type: e1-standard-4
    os_image: ubuntu2004
fail_fast:
  stop:
    when: "true"
auto_cancel:
  running:
    when: branch != 'master'
blocks:
  - name: build
    task:
      prologue:
        commands:
          - curl -L https://nixos.org/nix/install | sh
          - source /home/semaphore/.nix-profile/etc/profile.d/nix.sh
          - checkout
      jobs:
        - name: build custom packages
          commands:
            - nix-build shell.nix
